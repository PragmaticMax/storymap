<!DOCTYPE html>
<html lang="en">
<head>
    <title>Symbology</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">


    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />

    <!--animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <!--facebook and info icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--use a better font for this web map-->
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>


    <link rel="stylesheet" type="text/css" href="../../dist/storymap.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">
    <!--add required libraries-->
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="../../js/chroma.min.js"></script>


    <!--story map plugin-->
    <script src="../../dist/storymap.js"></script>

</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 main">
            <section data-scene="scene1">
                <h2>Default Style</h2>
            </section>
            <section data-scene="scene2">
                <h2>Scene 2</h2>
            </section>
            <section data-scene="scene3">
                <h2>Scene 3</h2>
            </section>
            <section data-scene="scene4">
                <h2>Scene 4</h2>
                <p><a href="https://github.com/gka/chroma.js/wiki/Predefined-Colors" target="_blank">Predefined Colors</a></p>
            </section>
            <section data-scene="scene5">
                <h2>Scene 5</h2>
            </section>
        </div>
        <div id="map" class="col-sm-6 col-md-8 sidebar"></div>
    </div>
    <!--add a scrolling down arrow-->
    <div class="animated zoomIn infinite glyphicon glyphicon-menu-down arrow-down"></div>
    <!--add a navigation bar-->
    <div class="navbar text-center"></div>

</div>

<!-- main javascript -->
<script type="text/javascript">

    <!--Plain -->
    var county_legend ='<i style="background: black; opacity: 0.5"></i><p><b>Counties</b></p>';
    var counties = L.geoJson.ajax('../../assets/counties.geojson',  {
        color: 'black',
        weight: 2,
        opacity: 0.3});

    <!--Choropleth -->
    // Set function for color ramp
    function setColor(density){
        return  density > 18 ? '#b30000' :
                density > 13 ? '#e34a33' :
                density > 10 ? '#fc8d59' :
                density >  5 ? '#fdcc8a' :
                '#fef0d9';
    }

    // Set style function that sets fill color property equal to cell tower density
    function style(feature) {
        return {
            fillColor: setColor(feature.properties.CT_CNT),
            fillOpacity: 0.5,
            weight: 2,
            opacity: 0.8,
            color: '#ffffff',
            dashArray: '4'
        };
    }


    var counties_choropleth = L.geoJson.ajax('../../assets/counties.geojson',
        {
            style: style,
            onEachFeature: function (feature, layer) {
                layer.bindTooltip(feature.properties.NAME, {className: 'feature-label', permanent: true, direction: 'center'});
            }
        });


    $('html > head').append($("<style> .marker-icon { color: rgba(227, 0, 12, 0.7); font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));

    var towers = L.geoJson.ajax('../../assets/cell_towers.geojson', {
        pointToLayer: function (feature, latlng) {

            return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon'})});
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Name, {sticky: true, className: "feature-tooltip"});
        }
    });

    var tower_legend ='<i class="glyphicon glyphicon-signal marker-icon"></i><p><b>Tower</b></p>';



    var colors = chroma.scale('Set1').mode('lch').colors(10);
    for (i =1; i < 11; i++) {
        $('html > head').append($("<style> .marker-icon-" + i.toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 3px #ffffff;} </style>"));
    }


    var towers_color = L.geoJson.ajax('../../assets/cell_towers.geojson', {
        pointToLayer: function (feature, latlng) {
            if (feature.properties.company == "New Cingular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-1'})});
            } else if (feature.properties.company == "Cellco") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-2'})});
            } else if (feature.properties.company == "RCC Minnesota") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-3'})});
            } else if (feature.properties.company == "Oregon RSA") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-4'})});
            } else if (feature.properties.company == "Verizon") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-5'})});
            } else if (feature.properties.company == "US Cellular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-6'})});
            } else if (feature.properties.company == "Hood River Cellular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-7'})});
            } else if (feature.properties.company == "Medford Cellular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-8'})});
            } else if (feature.properties.company == "Salem Cullular") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-9'})});
            } else {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-signal marker-icon-10'})});
            }
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.Name, {sticky: true, className: "feature-tooltip"});
        }
    });

    var tower_color_legend = '<p><b>Tower Companies</b></p>'+
        '<i class="glyphicon glyphicon-signal marker-icon-1"></i><p>New Cingular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-2"></i><p>Cellco</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-3"></i><p>RCC Minnesota</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-4"></i><p>Oregon RSA</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-5"></i><p>Verizon</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-6"></i><p>US Cellular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-7"></i><p>Hood River Cell.</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-8"></i><p>Medford Cellular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-9"></i><p>Salem Cullular</p>' +
        '<i class="glyphicon glyphicon-signal marker-icon-10"></i><p>Others</p>';


    var layers = {
        'counties': [ counties, county_legend],
        'counties_choropleth': [ counties_choropleth, county_legend],
        'towers': [towers, tower_legend],
        'towers_color': [towers_color, tower_color_legend]
    };


    var scenes = {
        scene1: {lat: 44, lng: -123.5, zoom: 7, name: 'Plain', layers: ['counties']},
        scene2: {lat: 44, lng: -123.5, zoom: 7, name: 'Choropleth', layers: ['counties_choropleth']},
        scene3: {lat: 44, lng: -123.5, zoom: 7, name: 'towers', layers: ['towers']},
        scene4: {lat: 44, lng: -123.5, zoom: 7, name: 'towers categorized by companies', layers: ['towers_color']},
        scene5: {lat: 44.05, lng: -123.0, zoom: 10, name: 'Markers', layers: ['towers_color']}
    };

    $('.main').storymap({
        scenes: scenes,
        layers: layers,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        scale: false,
        navbar: true,
        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map('map', {zoomControl: false, scrollWheelZoom: false});

            // add an base map, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw', {
                maxZoom: 18,
                attribution: '<a href="http://ceoas.oregonstate.edu/profile/zhao/" target="_blank">Bo Zhao</a>',
                id: 'mapbox.light',
                detectRetina: true
            }).addTo(map);


            // hidden the credits, but show in the about page.
            $(".leaflet-control-attribution").css("display", "none");
            return map;
        }
    });
</script>
</body>
</html>